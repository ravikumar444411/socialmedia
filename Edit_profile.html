<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" 
    href="https://use.fontawesome.com/releases/v5.6.3/css/fontawesome.css" 
    integrity="sha384-jLuaxTTBR42U2qJ/pm4JRouHkEDHkVqH0T1nyQXn1mZ7Snycpf6Rl25VBNthU4z0" 
    crossorigin="anonymous">
 

<script defer src="all.min.js"></script> 
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-storage.js"></script>

<script>
    var address = 'https://firebasestorage.googleapis.com/v0/b/storywory-f3401.appspot.com/o/Blog%20Images%2Fgate2.jpg_1592289650231?alt=media&token=c5e75fa5-d79b-4e97-8a4a-c54881a31f03';
</script>
<style>
    #main-backgroundImg{
            display:none
        }
    #main-profileImg{
            display:none
        }
    .circle{
            width:40%;
            max-width: 100%;
    border-radius:50%;
    background-size: cover;
    padding: 40px;
    border:2px solid #000;
    box-shadow:0 0 10px #000;
  }
  
  .circle:after{
    content:"";
   
    padding-bottom:100%;
    display:block;
  }
</style>
</head>
  <body>
      
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script src="js/index.js"></script>
    <script>
         var uri;
var qsParm = new Array();
function qs() {
    var query = window.location.search.substring(1);
    var parms = query.split('&');
    for (var i=0; i < parms.length; i++) {
        var pos = parms[i].indexOf('=');
        if (pos > 0) {
            var key = parms[i].substring(0, pos);
            var val = parms[i].substring(pos + 1);
            qsParm[key] = val;
            return qsParm[key];
        }
    }
}
var userID = qs();

    </script>
      <script>
        $(function(){
           $("#includedContent").load("navbar.html"); 
         });
     </script>
            
    <div class="container">
      
          <div id="includedContent"></div>
    
        <div class="row ">
           <!---------Left Side Start  -->
 
          <div class="col-12 col-sm-4 border " id="RightSection">
            <div class="card  d-flex p-2 bd-highlight ">
                           
                    <img  class="card-img-top mx-auto img-fluid" style="height: 220px;" id="backgroundImg" >
                    <input id="main-backgroundImg" type="file"/>
                    <i class="fas fa-pencil-alt h3" id="edit_background"></i>
                    <div class="card-body ">
                        <div class="row  ">
                 
                          <div class="circle mx-auto" id="profileImg"></div>
                          <input id="main-profileImg" type="file"/>
                          <i class="fas fa-pencil-alt h3" id="edit_profile"></i>
                         
                       
                     
                    </div>
                    
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="exampleFormControlTextarea1">Bio</label>
                    <textarea class="form-control" id="bio" placeholder="Write somthing about you" rows="3"></textarea>
                  </div>
            </div>
        <!---------Left Side End -->

         <!--------------  Right Side start --------------->
         <div class="col-12  col-sm-8 border ">     
          <p class="h2 text-center text-primary">Your Profile</p>
            
          
          
          <div class="form-row align-items-center mt-2">  
                <label for="inputPassword" class="col-sm-2 col-form-label">Name :</label>
                <div class="col-sm-8 input-group ">
                    <div class="input-group-prepend">
                        <i class="fas fa-user h1"></i>
                    </div>
                    <input type="text" class="form-control ml-1"  placeholder="Username" id="name">
                  </div>
            </div>
            <div class="form-row align-items-center mt-2">
                <label for="inputPassword" class="col-sm-2 col-form-label">Username :</label>
                <div class="col-sm-8 input-group ">
                  <div class="input-group-prepend">
                  <i class="far fa-user-circle  h1 "></i>
                  </div>
                  <input type="text" class="form-control ml-1"  placeholder="Username" id="username">
                </div>  
            </div>
          <div class="form-row align-items-center mt-2">  
                <label for="inputPassword" class="col-sm-2 col-form-label">Email : </label>
                <div class="col-sm-8 input-group ">
                    <div class="input-group-prepend">
                        <i class="fas fa-envelope-open-text h1"></i>
                    </div>
                    <input type="text" class="form-control ml-1"  placeholder="Username" id="email">
                  </div>
            </div>
            <div class="form-row align-items-center mt-2">
                <label for="inputPassword" class="col-sm-2 col-form-label">Phone No :</label>
                <div class="col-sm-8 input-group ">
                    <div class="input-group-prepend">
                        <i class="fas fa-phone-alt h1"></i>
                    </div>
                    <input type="text" class="form-control ml-1"  placeholder="Username" id="phone">
                  </div>  
            </div>
          <div class="form-row align-items-center mt-2">  
                <label for="inputPassword" class="col-sm-2 col-form-label">Date of Birth :</label>
                <div class="col-sm-8 input-group ">
                    <div class="input-group-prepend">
                        <i class="fas fa-calendar-alt h1"></i>
                    </div>
                    <input type="date"  class="form-control ml-1"  placeholder="Username" id="dob">
                  </div>
            </div>
            
                <fieldset class="form-group">
                  <div class="row">
                    <legend class="col-form-label col-sm-2 pt-0">Gender :</legend>
                    <div class="col-sm-10">
                      <div class="form-check">
                        <input class="form-check-input gender" type="radio" name="gender"  value="male" checked>
                        <label class="form-check-label" for="gender">
                         Male
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input gender" type="radio" name="gender"  value="female">
                        <label class="form-check-label" for="gender">
                          Female
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input gender" type="radio" name="gender"  value="other">
                        <label class="form-check-label" for="gender">
                          Other
                        </label>
                      </div>
                    </div>
                  </div>
                </fieldset>
                
                <div class="form-group row">
                  <div class="col-sm-10">
                    <button type="button" class="btn  btn-lg btn-block" style="background-color: #faa0f5;" id="save">Save</button>
                    <button type="button" class="btn btn-danger btn-lg btn-block">Cancel</button>
                  </div>
                </div>
           
          </div>
    <!-----------------------Right Side End ------------>
      
      </div>
      <img src="logo/add.png" onclick="switchView('Create_story.html')" width="80px" id="popup" >
<style>
#popup{
  position: fixed;
  bottom: 40px;
  right: 10px;
  }
      </style>
    <script>
        firebase.auth().onAuthStateChanged(function(user)
        {
            if(!user)
                window.location.href = "signin.html";
            if(user)
            {

                console.log(user.uid)
                firebase.database().ref('Users/' + user.uid).on('value', function(snapshot) {
                     userObj = snapshot.val()
                     console.log(userObj)
                    $("#name").val(userObj.firstName);
                    $("#username").val(userObj.username);
                    $("#email").val(userObj.email);
                    $("#phone").val(userObj.phone);
                    $("#dob").val(userObj.dob);
                    $("#gender").val(userObj.gender);
                    $("#backgroundImg").attr('src', userObj.backgroundImg);
                    $("#profileImg").css('background-image', 'url('+ userObj.profileImg+')');
                    $("#bio").val(userObj.bio);
                })

                    //                 #upload_link{
                    //     text-decoration:none;
                    // }
                    
                    // id="upload_link"
                    // <input id="main-image" type="file"/>
                  var profileImg;
                  var backgroundImg;

      /*********background Img Update start*************/              
                            $("#edit_background").on('click', function(e){
                                e.preventDefault();
                               
                                $("#main-backgroundImg:hidden").trigger('click');
                            });
                            $("#main-backgroundImg").on('change', function(e){
                                e.preventDefault();
                                var valiImagetypes = ["image/gif","image/jpeg","image/png"];
                                var backgroundImg = $("#main-backgroundImg").prop("files")[0];
                 
                                // *******Upload & save to firebase database & storage

                                var databaseRef = firebase.database().ref().child("Users");
                                databaseRef.once("value").then(function(snapshot)
                                {
                                var name = backgroundImg["name"];
                                var dateStr = new Date().getTime();
                                var fileCompleteName = name + "_"+dateStr;
                                var storageRef = firebase.storage().ref().child("Blog Images");
                                var blogStorageRef = storageRef.child(fileCompleteName);
                                var uploadTask = blogStorageRef.put(backgroundImg);
                                var updates = {};

                                uploadTask.on("state_changed", 
                                function progress(snapshot)
                                    { },
                                function error(err)
                                {},
                        function complete(){
                                uploadTask.snapshot.ref.getDownloadURL().then(function(downloadUrl){
                             
                                    updates['/Users/'+ user.uid + '/backgroundImg/' ] = downloadUrl;
                                    firebase.database().ref().update(updates);
                                    if(updates)
                                alert(" profile backgroud Image successfully")
                                })

                            })

                                });

                                // *******Upload & save to firebase database & storage
                            });

  /*********background Img Update end*************/ 


      /*********Profile Img Update start*************/                      
                            $("#edit_profile").on('click', function(e){
                                e.preventDefault();
                               
                                $("#main-profileImg:hidden").trigger('click');
                            });
                            $("#main-profileImg").on('change', function(e){
                                e.preventDefault();
                                var valiImagetypes = ["image/gif","image/jpeg","image/png"];
                                var profileImg = $("#main-profileImg").prop("files")[0];
                                // *******Upload & save to firebase database & storage

                                var databaseRef = firebase.database().ref().child("Users");
                                databaseRef.once("value").then(function(snapshot)
                                {
                                var name = profileImg["name"];
                                var dateStr = new Date().getTime();
                                var fileCompleteName = name + "_"+dateStr;
                                var storageRef = firebase.storage().ref().child("Blog Images");
                                var blogStorageRef = storageRef.child(fileCompleteName);
                                var uploadTask = blogStorageRef.put(profileImg);
                                var updates = {};

                                uploadTask.on("state_changed", 
                                function progress(snapshot)
                                    { },
                                function error(err)
                                {},
                        function complete(){
                                uploadTask.snapshot.ref.getDownloadURL().then(function(downloadUrl){
                             
                                    updates['/Users/'+ user.uid + '/profileImg/' ] = downloadUrl;
                                    firebase.database().ref().update(updates);
                                    if(updates)
                                alert(" profile Image update successfully")
                                })

                            })

                                });

                                // *******Upload & save to firebase database & storage
                            });
 /*********Profile Img Update End*************/ 
                            
                
     /*********Save profile details start *************/                        
                            $("#save").click(function(){
                        var updates = {};
                     updates['/Users/'+ user.uid + '/firstName/' ] = $("#name").val();
                    updates['/Users/'+ user.uid + '/username/' ] = $("#username").val();
                    updates['/Users/'+ user.uid + '/email/' ] = $("#email").val();
                    updates['/Users/'+ user.uid + '/phone/' ] = $("#phone").val();
                    updates['/Users/'+ user.uid + '/dob/' ] = $("#dob").val();
                    updates['/Users/'+ user.uid + '/gender/' ] = $("input[name='gender']:checked"). val();
                       firebase.database().ref().update(updates);
                       if(updates)
                                alert("update profile successfully")
                   
                    });

    /*********Save profile details  End*************/ 


            }
            
        });
    </script>

    
  
</body>
</html>