<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" 
    href="https://use.fontawesome.com/releases/v5.6.3/css/fontawesome.css" 
    integrity="sha384-jLuaxTTBR42U2qJ/pm4JRouHkEDHkVqH0T1nyQXn1mZ7Snycpf6Rl25VBNthU4z0" 
    crossorigin="anonymous">
 

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script defer src="all.min.js"></script> 
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-storage.js"></script>

<script src="js/index.js"></script>

<style>
    .circle{
    background-image:url("http://4.bp.blogspot.com/-0H3_WCM-j18/UfVc4YIheyI/AAAAAAAAArM/5j--KBDa_90/s640/Free+download+Natural+Wallpaper+background+Green+Nature+with+sunrise+wallpaper.png");
    width:110%;
    border-radius:50%;
    border:2px solid #000;
    box-shadow:0 0 10px #000;
  }
  
  .circle:after{
    content:"";
    padding-bottom:100%;
    display:block;
  }
</style>
</head>
  <body>
    <script>
         var uri;
var qsParm = new Array();
function qs() {
    var query = window.location.search.substring(1);
    var parms = query.split('&');
    for (var i=0; i < parms.length; i++) {
        var pos = parms[i].indexOf('=');
        if (pos > 0) {
            var key = parms[i].substring(0, pos);
            var val = parms[i].substring(pos + 1);
            qsParm[key] = val;
            return qsParm[key];
        }
    }
}
var userID = qs();

console.log(userID)
    </script>
            
    <div class="container">
       <!---Menu Navbar-->
       <div class="row" style="background-color: #f7adeb; height: 80px;">
        <div class="col-12">
            <div class="d-flex bd-highlight">
                <div class="p-2  bd-highlight">  <a class="navbar-brand" href="#"><img src="logo/logo2.png"></a></div>
                    <div class="p-2 flex-fill  ">
                        <nav class="navbar navbar-light  ">
                            <input class="form-control rounded-pill " style="width: 80%; " type="search" placeholder="Search" aria-label="Search" id="search"/>                            
                            <button class="btn btn-outline-success" style="width: 15%;" type="submit"><i class="fas fa-search mr-5 mr-sm-0 "></i></button>

                            <div class="card mt-2 overflow-auto" style="width: 18rem;">
                              <ul class="list-group list-group-flush" id="list"></ul>
                              </div>
                           
                        </nav>
                    </div>
                <div class="p-2  bd-highlight">
                    <nav class="navbar navbar-expand-lg navbar-light ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active">
                                    <i style="font-size:35px;"color="blue" onclick="mainfun()" class="fas fa-home"></i>
                                </li>
                                <li class="nav-item  ml-3">
                                    <i style="font-size:35px;"color="blue" class="fas fa-user-circle ml-3 onclick="mainfun()"></i>
                              
                                </li>
                                <li class="nav-item ml-3">
                                    <i class="far fa-images" style="font-size:35px;"color="blue" onclick="showImage('#container')"></i>
                                   
                                </li>
                                <li class="nav-item  ml-3">
                                    <i class="fas fa-video" style="font-size:35px;"color="blue" onclick="showVideo('#container')"></i> 
                                  </li>
                                  
                                  <li class="nav-item ml-3">
                                      <i class="far fa-comment-dots" style="font-size:35px;"color="blue" onclick="mainfun()"></i>
                                    </li>
                                <li class="nav-item  ml-3">
                                    <i class="fas fa-user-cog" style="font-size:35px;"color="blue" onclick="mainfun()"></i> 
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
          </div>
        </div>
    </div>
    <!---End Menu Navbar-->

    
        <div class="row ">
           
          
          
     <!--------------  Post page --------------->
            <div class="col-12  col-sm-8 border ">.      
            <div class="border" id="container"> 
                
            </div>
          </div>
    <!-----------------------End Post page ------------>



           <!---------Right section -->
 
          <div class="d-none d-sm-block col-sm-4 " id="RightSection">
             
            
                <!---------End Right section -->
        </div>
      
      </div>
      <img src="logo/add.png" onclick="switchView('Create_story.html')" width="80px" id="popup" >
      




    
      <style>
        #popup{
  position: fixed;
  bottom: 40px;
  right: 10px;
  }
      </style>
      <script>          
    function showImage(){
        $("#container").addClass("row");
       
            firebase.database().ref('Blogs/').orderByChild("uid").equalTo(userID).on('value', function(snapshot) {
            var blogsHtml = '';
                snapshot.forEach(function(singleBlog)
                { 
                    console.log(singleBlog.val().image)
                    if(singleBlog.val().type == 'image/jpeg')
                    {
                        blogsHtml +=    `<div class=" col-4">
                                        <img src=${singleBlog.val().image} class="card-img-top mx-auto img-fluid p-2" >   
                                       
                                    </div>
                                   
                                  `

                     }
                })
                $("#container").html(blogsHtml);
            })
            }

function showVideo(){
    $("#container").addClass("row");
            firebase.database().ref('Blogs/').orderByChild("uid").equalTo(userID).on('value', function(snapshot) {
            var blogsHtml = '';
                snapshot.forEach(function(singleBlog)
                { 
                    console.log(singleBlog.val().image)
                    if(singleBlog.val().type == 'video/mp4')
                    {
                        blogsHtml +=    `<div class="col-4">
                                   <video class="card-img-top"  controls ><source src=${singleBlog.val().image} type="video/mp4"></video>
                                         
                                    </div>
                                   
                                  `

                     }
                })
                $("#container").html(blogsHtml);
            })

        }
      </script>




<script>
   /**********Right side profile end***************/   


  

    firebase.database().ref('Users/' + userID).on('value', function(snapshot) {



        // var userList = {profileImg:snapshot.val().profileImg, firstName:snapshot.val().firstName,bio:snapshot.val().bio };

        // var encodedStr = JSON.stringify(userList); 


    //    console.log(userList);
    //    var mydesh = JSON.stringify(userList); 
    //   console.log(mydesh);
       
//     
  var htmlData;
    htmlData = `
            <div class="card  d-flex p-2 bd-highlight ">
                <a class="" href="#" style="margin-left: 90%;" >edit</a>
               
                    <img src=${snapshot.val().backgroundImg} class="card-img-top mx-auto img-fluid" style="height: 220px; width: 320px;">
                    <div class="card-body ">
                        <div class="row  ">
                  <div class="col-sm-12 col-md-8 col-lg-4">
                          <div class="circle " style="background-image:url(${snapshot.val().profileImg});"></div>
                        </div>
                      <div class=" col-sm-12 col-md-12 col-lg-8" >
                          <h5 id="username">${snapshot.val().firstName}</h5>
                            <p>${snapshot.val().bio}</p>
                            
                        </div>
                    </div>
                    
                    </div>
                  </div>
          
                <div class="row mx-0 ">
                   
                    <span class="col-md-4  col-sm-6 "><a href="#">Followers</a> <br/>
                        <i class='fas fa-users'  style="font-size:25px;" color="skyblue" ` + " onclick=goToFollow('"+ userID +"')></i>"
                  +`      ${snapshot.val().followers}</span>
                          <span class="col-md-4  col-sm-6 "><a href="#">Follwing</a> <br/>
                        <i class="fas fa-user-check"  style="font-size:25px;"color="skyblue" ` + " onclick=goToFollow('"+ userID +"')>"
                  +`         </i>${snapshot.val().following}</span>
                        <span class="col-md-4 "><a href="#">Hits</a><br>
                                <i class="fas fa-heart" style="font-size:25px;"color="pink"></i>${snapshot.val().hits}</span>
                        
                        </div>
                    
                        <div class="row mx-0 mt-2 mt ">
                        
                            <span class="col-md-4 col-sm-6 "> <i class="far fa-images" style="font-size:25px;"color="blue" onclick="showImage()"></i><br/>${snapshot.val().images}</span>
                            <span class="col-md-4 "><i class="fas fa-file-video" style="font-size:25px;"color="lightgreen" onclick="showVideo()"></i> <br/>${snapshot.val().videos}</span>
                            <span class="col-md-4 "></span>
                        
                        </div>
                        <button type="button" class="btn btn-info mt-2 btn-lg" ` + " onclick=followHandle('"+ userID +"')>Follow</button> <br/>"
                    


            +`      <div class="ml-3 mt-4">
                    <div class="card" style="width: 18rem;">
                        <div class="card-body">
                          <h5 class="card-title">About</h5>
                          <h6 class="card-subtitle mb-2 text-muted">${snapshot.val().bio}</h6>
                          <p class="card-text">
                            location: ${snapshot.val().address} <br>
                            Date of birth: ${snapshot.val().dob}<br>
                            gender: ${snapshot.val().gender}<br>
                            phone: ${snapshot.val().phone}<br>
                            country: ${snapshot.val().country}
                            </p>
                          <a href="#" class="card-link">Website</a>
                          <a href="#" class="card-link">facebook page</a>
                        </div>
                      </div>
                  </div>

            </div>`
                        $("#RightSection").html(htmlData);
});
 /**********Right side profile end***************/
   </script>


<script>
    function goToFollow(userID){

window.location = 'Follower.html?somval=' + userID;

}
    function followHandle(person){
        // console.log(person);
        //          var obj = JSON.parse(person);
        //          console.log(obj)
  
        var my_userID = firebase.auth().currentUser.uid;
       
        firebase.database().ref('Users/' + userID).on('value', function(snapshot) {
                var updates = {};
         //   updates['/following/'+ my_userID +'/' + obj.userID +'/uid'  ] = snapshot.val().;
            updates['/following/'+ my_userID +'/' + userID +'/firstName'  ] = snapshot.val().firstName;
            updates['/following/'+ my_userID +'/' + userID +'/bio'  ] = snapshot.val().bio;
            updates['/following/'+ my_userID +'/' + userID +'/profileImg'  ] = snapshot.val().profileImg;

            updates['/follower/'+ userID +'/' + my_userID  +'/firstName'  ] = snapshot.val().firstName;
            updates['/follower/'+ userID +'/' + my_userID  +'/bio'  ] = snapshot.val().bio;
            updates['/follower/'+ userID +'/' + my_userID  +'/profileImg'  ] = snapshot.val().profileImg;

            firebase.database().ref().update(updates);
        })
       
       
  





    }
</script>
   <script>
      /**********Left side Story section start***************/ 

        firebase.database().ref('Blogs/').orderByChild("uid").equalTo(userID).on('value', function(snapshot) {
            var blogsHtml ='';
                snapshot.forEach(function(singleBlog)
                {
                 //   console.log(singleBlog.val())
                blogsHtml += `<div class="card mb-3 ">
                    <div class="card-header" id="headerArea">
                        
                        <div class="row">
                      <div class="col-sm-1 "> <img  src=${singleBlog.val().profileImg} style="width:40px; height:40px; border-radius: 50% "/></div>
                    <div class="col-sm h4 ml-2 text-parimary" ` + " onclick=goToProfile('"+singleBlog.val().uid+"')> "
          +`         ${singleBlog.val().postBy}  </div> <div class="col-sm-1"> 
                        
                        <i class="fas fa-chevron-down"  id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="#">Share</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Share to </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item"  ` + " onclick=deleteblogRecord('"+singleBlog.key+"')>Remove</a>"
                 +`       </div> 
                        </div>
                        </div>
                        </div>
                    
                    
                    ${frame(singleBlog.val().type, singleBlog.val().image)}
                                <div class="row">
                                    <div class="col-sm">
                                        <a href=${singleBlog.val().image} download><i class="fas fa-download text-primary h3 mt-1"></i></a>
                                     </div>
                                    <div class="col-sm">
                                    Date: ${singleBlog.val().date} , time:  ${singleBlog.val().time}
                                    </div>
                                    <div class="col-sm">
                                    One of three columns
                                    </div>
                                </div>
                                <div class="card-body">
                                <h5 class="card-title">Card title</h5>
                                <p class="card-text"> ${singleBlog.val().desc}</p>
                                <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                </div>

                            <i class="fas fa-heart h2 "  id="likebutton"  `  + " onclick=likeHandle('"+singleBlog.key+"')></i>"
            +`   <div class="form-group  row">
        
                        <input type="text" class="form-control col-lg-9 col-sm-8 col-8  ml-3 mr-1" id="comment" placeholder="Comment here .....">
                    
                        <button type="submit" class='btn btn-primary col-lg-2 col-sm-2 col-2 mr-3 ' `  + " onclick=postComment('"+singleBlog.key+"')> <i class='fas fa-search'></i></button></div> </div>"
                        });
                
                $("#container").html(blogsHtml);
     
});
 





function frame(type, url)
{
    if(type == 'image/jpeg')
       return  ` <img src=${url} class="card-img-top" alt="..."/>`;
    else if(type == 'video/mp4')
      return   `<video class="card-img-top"  controls ><source src=${url}  type="video/mp4"></video> `
}
 /**********Left side Story section end***************/ 
   </script>

    <script>
        firebase.auth().onAuthStateChanged(function(user)
        {
            if(!user)
            {
                window.location.href = "signin.html";
            }
        });
    </script>

    
  
</body>
</html>